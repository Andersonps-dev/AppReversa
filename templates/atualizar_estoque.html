<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Credenciais</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="icon" type="image/png" href="https://i.postimg.cc/ZKPM50BD/distribuido-1.png">
    <link rel="stylesheet" href="{{ url_for('static', filename='atualizar_estoque.css') }}">

</head>
<body>
    {% include 'navbar.html' %}

    <div id="loading-overlay" class="loading-overlay d-none" style="position:fixed;top:0;left:0;width:100vw;height:100vh;background:rgba(255,255,255,0.85);z-index:9999;display:flex;flex-direction:column;align-items:center;justify-content:center;">
        <div class="spinner" style="width:3rem;height:3rem;border:6px solid #4361ee;border-top:6px solid #fff;border-radius:50%;animation:spin 1s linear infinite;"></div>
        <p style="margin-top:1.5rem;font-size:1.1rem;color:#4361ee;font-weight:500;">Atualizando estoque, aguarde...</p>
    </div>
    <div class="atualizar-card">
        <div class="atualizar-icon">
            <i class="bi bi-arrow-repeat"></i>
        </div>
        <div class="atualizar-title">Atualizar Estoque</div>
        <form id="estoque-form" method="post" action="{{ url_for('atualizar_estoque') }}">
            <button type="submit" class="btn btn-atualizar">Atualizar Estoque</button>
        </form>
        {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="status-msg">
            {% for category, message in messages %}
                <div class="alert alert-{{ category }}">{{ message }}</div>
            {% endfor %}
            </div>
        {% endif %}
        {% endwith %}
        {% if data_atualizacao_estoque %}
        <div class="status-msg">
            <span class="text-muted">Última atualização: {{ data_atualizacao_estoque.strftime('%d/%m/%Y %H:%M') }}</span>
        </div>
        {% endif %}
    </div>
    <script>
    // Exibe o loading quando o formulário for enviado e bloqueia interação
    document.getElementById("estoque-form").addEventListener("submit", function(e) {
        var overlay = document.getElementById("loading-overlay");
        overlay.classList.remove("d-none");
        document.body.style.overflow = "hidden";
        // Impede teclas e mouse
        overlay.addEventListener("click", function(ev) { ev.stopPropagation(); ev.preventDefault(); }, true);
        window.addEventListener("keydown", function(ev) { ev.preventDefault(); }, true);
    });
    // Animação spinner
    var style = document.createElement('style');
    style.innerHTML = '@keyframes spin {0%{transform:rotate(0deg);}100%{transform:rotate(360deg);}}';
    document.head.appendChild(style);
    </script>
</body>
